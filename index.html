<!DOCTYPE html>
<html>

<head>

	<meta charset="utf-8" />
	<meta name="viewport"
		content="width=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />

	<link href="styles.css" rel="stylesheet">

	<title>R4G</title>

	<!-- scripts for blockly code -->
	<script src="blockly_compressed.js"></script>
	<script src="blocks_compressed.js"></script>
	<script src="js/en.js"></script>
	<script src="javascript_compressed.js"></script>

</head>

<!-- header -->
<div class="container-fluid zimd_header text-center">
	<!-- <h3>R4G</h3> -->
	<img src="media/roberta.png" class="img-circle" style="float:center;width:100px;height:100px;">
	<h3>Robo4Girls</h3>
</div>

<!-- body -->
<body ontouchstart="" id="body">
	<!-- ontouchstart="" enables low-delay CSS transitions. -->

	<!-- Bluetooth communication -->
	<div class="container-fluid bluetooth"/>
	<h3>Verbinde dich mit deinem micro:bit über Bluetooth:</h3>

	<button id="connect" type="button">Verbinden</button>
	<button id="disconnect" type="button">Trennen</button>

	<!-- input file and button for sending data
	<input id="input" type="text" />
	<button id="sendData" type="button">Senden</button>
	 -->

	<!-- terminal, text color changes: debug=grey, input=blue, output=red -->
	<div class="term" id="terminal"></div>

	<!-- script for bluetooth communication -->
	<script type="text/javascript" src="ble3.js"></script>

	<!--</div> -->

	<!-- R4G programming environment -->
	<h3>Viel Spaß beim programmieren!</h3>

	<script>
		function handlePlay(event) {
			Blockly.JavaScript.addReservedWords('code');
			var code = Blockly.JavaScript.workspaceToCode(Blockly.getMainWorkspace());
			
			var commands = code.split(":");
			var max_length = 19;
			for(var i = 0; i < commands.length; i++){
				if(commands[i].length > max_length){
					commands[i]= commands[i].substring(0, max_length);
				}
				commands[i] += ":";
				console.log(commands[i]);
			}
			
			return sendData(commands, 0);
		}
	</script>

	<!-- play button starts program -->
	<button onclick="handlePlay()" type="button">Start</button>


	<!-- blockly programming window -->
	<div id="blocklyDiv" style="position: absolute; width: 70%;"></div>

	<!-- R4G blocks design -->
	<xml xmlns="http://www.w3.org/1999/xhtml" id="toolbox" style="display: none;">
		<!-- Category Movements -->
		<category name="Bewegungen" colour="#5b5ba5">
			<block type="forward">
				<field name="forward_duration">0.1</field>
			</block>	
			<block type="back">
				<field name="back_duration">0.1</field>
			</block>
			<block type="left">
				<field name="left_duration">0.1</field>
			</block>
			<block type="right">
				<field name="right_duration">0.1</field>
			</block>
			<block type="turn_left">
				<field name="turn_left_duration">0.1</field>
			</block>
			<block type="turn_right">
				<field name="turn_right_duration">0.1</field>
			</block>
		</category>
		<category name="Kombinationen" colour="#a55b6d">
			<block type="dance">
				<field name="repeat">1</field>
				<field name="intensity">sanft</field>
			</block>
			<block type="zigzag">
				<field name="repeat">1</field>
				<field name="intensity">sanft</field>
			</block>
			<block type="shake">
				<field name="repeat">1</field>
				<field name="intensity">sanft</field>
			</block>
			<block type="pirouette">
				<field name="repeat">1</field>
				<field name="direction">Links</field>
			</block>
		</category>
		<category name="Melodie" colour="#a55b5b">
			<block type="melody">
				<field name="melody">M1</field>
			</block>
		</category>
		<category name="Einstellungen" colour="#a5a55b">
			<block type="motor">
				<field name="motor">1</field>
				<field name="velocity">400</field>
			  </block>
		</category>
		<category name="LED-Anzeige" colour="#5ba593">
			<block type="show_text"></block>
			<block type="show_picture">
				<field name="pic">happy_face</field>
				<field name="show_duration">0</field>
			</block>
		</category>
		<category name="Steuerung" colour="#5ba55b">
			<block type="repetition">
				<field name="repetition">1</field>
			</block>
		</category>
	</xml>

	<!-- Making Toolbox visible in Web-browser -->
	<script>
		var workspace = Blockly.inject('blocklyDiv', {
			media: 'media/',
			toolbox: document.getElementById('toolbox')
		})
	</script>

	<!-- Blockly scripts -->
	<script src="scripts/R4Gblocks.js"></script>

</body>

</html>